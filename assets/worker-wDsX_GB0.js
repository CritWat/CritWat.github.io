(function(){"use strict";importScripts("/build/parser.min.js");const u=0,m=1,b=2,R=3,_=4;let d=null,s=null,r=null,i=-1,c=!1,p="jszip.min.js";function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}function l(e){postMessage({msg_type:b,data:e})}function y(e){E(e)}function E(e){const t=new XMLHttpRequest;c&&(t.onprogress=function(a){postMessage({msg_type:_,id:i,loaded:a.loaded,total:a.total})}),t.onreadystatechange=function(a){t.readyState===4&&t.status===200&&f(t.response)},t.open("GET",e,!0),t.responseType="arraybuffer",t.send(null)}function f(e){if(e)try{parse_3d_file(d,e,A,p)}catch{l("Error parsing the file")}else l("no data")}function A(e){typeof e!="string"?postMessage({msg_type:R,vertices:e.vertices,faces:e.faces,colors:e.colors}):l(e)}function g(e){const t=new FileReader;t.onerror=function(a){let o="";switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:o="File not found";break;case a.target.error.NOT_READABLE_ERR:o="Can't read file - too large?";break;case a.target.error.ABORT_ERR:o="Read operation aborted";break;case a.target.error.SECURITY_ERR:o="File is locked";break;case a.target.error.ENCODING_ERR:o="File too large";break;default:o="Error reading file"}l(o)},t.onprogress=function(a){postMessage({msg_type:_,id:i,loaded:a.loaded,total:a.total})},t.onload=function(a){f(a.target.result)},t.readAsArrayBuffer(e)}self.addEventListener("message",function(e){switch(e.data.msg_type){case u:if(!e.data.data){l("no data");break}if(!e.data.data.filename&&!e.data.data.local_file){l("no file");break}e.data.jszip_path&&(p=e.data.jszip_path),e.data.data.local_file?(d=e.data.data.local_file.name?e.data.data.local_file.name:e.data.data.filename,s=e.data.data.local_file?e.data.data.local_file:null):e.data.data.filename&&(d=e.data.data.filename),e.data.data.x&&n(e.data.data.x)&&e.data.data.x,e.data.data.y&&n(e.data.data.y)&&e.data.data.y,e.data.data.y&&n(e.data.data.z)&&e.data.data.z,r=null,e.data.load_from_blob_or_ab&&(r=e.data.load_from_blob_or_ab),i=e.data.data.id?e.data.data.id:-1,c=!!e.data.get_progress&&e.data.get_progress;break;case m:r?r instanceof ArrayBuffer?f(r):g(r):s?g(s):d&&y(d);break;default:console.log("invalid msg: "+e.data.msg_type)}})})();
